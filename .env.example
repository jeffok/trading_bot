# ========== 时区设置 ==========
# 作用：系统使用的时区，影响时间戳解析和日志时间显示
# 可选值：任何有效的时区名称（如 Asia/Hong_Kong、Asia/Shanghai、UTC）
# 实盘建议值：Asia/Hong_Kong（香港时区）
TIMEZONE=Asia/Hong_Kong

# ========== 初始化控制（容器启动时） ==========
# 跳过数据库迁移（容器启动时是否执行数据库迁移）
# 作用：控制容器启动时是否自动执行数据库迁移
# 可选值：
#   - 0 或未设置（执行迁移，推荐）
#   - 1（跳过迁移）
# 实盘建议值：0（保持默认，确保数据库结构最新）
# 说明：仅在需要手动控制迁移时设为 1
SKIP_DB_MIGRATIONS=0

# 跳过 Redis Streams 初始化（容器启动时是否初始化 Streams）
# 作用：控制容器启动时是否自动初始化 Redis Streams 和消费者组
# 可选值：
#   - 0 或未设置（执行初始化，推荐）
#   - 1（跳过初始化）
# 实盘建议值：0（保持默认，确保 Streams 和消费者组已创建）
# 说明：仅在需要手动控制初始化时设为 1
SKIP_REDIS_STREAMS_INIT=0

# ========== 外部依赖（必填） ==========
# PostgreSQL 数据库连接 URL
# 作用：系统主数据库，存储所有交易数据、订单、持仓、信号等（使用JSON格式存储）
# 格式：postgresql://用户名:密码@主机:端口/数据库名
# 实盘建议：使用独立的数据库实例，确保数据安全和备份
# 示例：postgresql://postgres:password@localhost:5432/trading_bot
# 说明：数据以JSON格式存储在PostgreSQL的JSONB字段中，提供更好的灵活性和查询能力
# ⚠️ 优先使用 POSTGRES_URL，如果未设置，系统会尝试从下方的 DB_* 参数构建连接URL
POSTGRES_URL=postgresql://postgres:password@postgres:5432/trading_bot

# 向后兼容：数据库连接参数（用于从 MySQL/MariaDB 迁移）
# 作用：如果未设置 POSTGRES_URL，系统会使用以下参数构建 PostgreSQL 连接URL
# 说明：这些参数仅用于向后兼容，推荐直接使用 POSTGRES_URL
# 数据库主机地址
DB_HOST=postgres

# 数据库端口
DB_PORT=5432

# 数据库用户名
DB_USER=postgres

# 数据库密码
# ⚠️ 重要：生产环境必须修改为强密码
DB_PASS=password

# 数据库名称
DB_NAME=trading_bot

# Redis 连接 URL
# 作用：用于缓存、分布式锁、消息队列、实时数据流等
# 格式：redis://[密码@]主机:端口/数据库编号
# 实盘建议：使用独立的Redis实例，确保高可用性
# 示例：redis://redis:6379/0
# 说明：数据库编号0-15，建议使用0作为主数据库
REDIS_URL=redis://redis:6379/0

# ========== 环境配置 ==========
# 运行环境
# 可选值：dev（开发）、staging（预发布）、prod（生产）
# 实盘建议值：prod
ENV=dev
APP_ENV=dev

# 日志级别
# 可选值：DEBUG、INFO、WARNING、ERROR、CRITICAL
# 实盘建议值：INFO（生产环境）或 WARNING（减少日志量）
LOG_LEVEL=INFO

# ========== 交易所配置 ==========
# 交易所名称
# 可选值：binance、bybit、paper（模拟交易）
# 实盘建议值：bybit 或 binance
EXCHANGE=paper

# 交易所类别
# 可选值：linear（线性合约）、inverse（反向合约）
# 实盘建议值：linear
EXCHANGE_CATEGORY=linear

# 期货杠杆倍数（默认值，实际会根据策略动态调整）
# 可选值：1-125（根据交易所限制）
# 实盘建议值：10-20（根据风险承受能力）
FUTURES_LEVERAGE=10

# Bybit 持仓索引（Hedge模式使用）
# 可选值：0（One-way模式）、1（Buy侧）、2（Sell侧）
# 实盘建议值：0（One-way模式，更简单）
BYBIT_POSITION_IDX=0

# ========== 交易对配置 ==========
# 单个交易对（向后兼容）
# 格式：交易对名称（如 BTCUSDT）
# 实盘建议：根据实际交易需求设置
SYMBOL=BTCUSDT

# 多个交易对（优先使用，逗号或空格分隔）
# 格式：BTCUSDT,ETHUSDT,BNBUSDT 或 BTCUSDT ETHUSDT BNBUSDT
# 实盘建议：根据策略和资金量选择3-20个交易对
SYMBOLS=BTCUSDT,ETHUSDT,BNBUSDT

# K线周期（分钟）
# 可选值：1、5、15、30、60、240等
# 实盘建议值：15（15分钟K线，适合趋势策略）
INTERVAL_MINUTES=15

# 策略执行周期（秒）
# 作用：策略引擎每个tick的执行间隔
# 实盘建议值：900（15分钟，与INTERVAL_MINUTES保持一致）
STRATEGY_TICK_SECONDS=900

# ========== 策略参数（Setup B） ==========
# ADX最小值（趋势强度指标）
# 作用：Setup B策略的ADX阈值，ADX>=此值才考虑入场
# 可选值：15-30
# 实盘建议值：18-20（降低可增加交易机会，但可能降低信号质量）
SETUP_B_ADX_MIN=20

# 成交量比率最小值
# 作用：Setup B策略的成交量放大倍数，当前成交量/平均成交量>=此值才考虑入场
# 可选值：1.2-2.0
# 实盘建议值：1.3-1.5（降低可增加交易机会）
SETUP_B_VOL_RATIO_MIN=1.5

# AI评分最小值
# 作用：Setup B策略的AI评分阈值，AI评分>=此值才考虑入场
# 可选值：45-60
# 实盘建议值：50-55（降低可增加交易机会）
SETUP_B_AI_SCORE_MIN=55

# ========== 风控参数 ==========
# 账户权益（USDT）
# 作用：用于计算风险预算和订单大小
# ⚠️ 重要：必须根据实际账户资金设置，否则可能导致下单失败或风险计算错误
# 实盘建议：设置为实际账户权益（如 1000、5000、10000等）
ACCOUNT_EQUITY_USDT=500

# 单笔交易风险预算百分比
# 作用：每笔交易最多亏损账户权益的百分比
# 可选值：0.01-0.05（1%-5%）
# 实盘建议值：0.03（3%，保守且合理）
RISK_BUDGET_PCT=0.03

# 最大回撤百分比
# 作用：账户回撤超过此值时触发风控
# 可选值：0.10-0.20（10%-20%）
# 实盘建议值：0.15（15%，合理的止损线）
MAX_DRAWDOWN_PCT=0.15

# 硬止损百分比
# 作用：单笔交易的最大亏损百分比
# 可选值：0.02-0.05（2%-5%）
# 实盘建议值：0.03（3%，适合大多数情况）
HARD_STOP_LOSS_PCT=0.03

# 熔断窗口（秒）
# 作用：熔断器的时间窗口
# 实盘建议值：300（10分钟）
CIRCUIT_WINDOW_SECONDS=600

# 熔断速率限制阈值
# 作用：速率限制错误次数超过此值时触发熔断
# 实盘建议值：8
CIRCUIT_RATE_LIMIT_THRESHOLD=8

# 熔断失败阈值
# 作用：失败次数超过此值时触发熔断
# 实盘建议值：6
CIRCUIT_FAILURE_THRESHOLD=6

# BTC交易对（用于市场分析）
# 实盘建议值：BTCUSDT
BTC_SYMBOL=BTCUSDT

# ========== 交易与风控 ==========
# 最大并发持仓数
# 作用：同时持有的最大仓位数量
# 可选值：3-10（根据资金量调整）
# 实盘建议值：3-5（小资金）或 5-10（大资金）
MAX_CONCURRENT_POSITIONS=3

# 最小订单保证金（USDT）
# 作用：每笔订单的最小保证金要求
# 实盘建议值：50（Bybit等交易所的最低要求）
MIN_ORDER_USDT=50

# 自动杠杆下限
# 作用：根据AI评分自动选择杠杆时的最小杠杆
# 可选值：5-15
# 实盘建议值：10
AUTO_LEVERAGE_MIN=10

# 自动杠杆上限
# 作用：根据AI评分自动选择杠杆时的最大杠杆
# 可选值：15-25
# 实盘建议值：20
AUTO_LEVERAGE_MAX=20

# 盈利退出时标记为TAKE_PROFIT
# 作用：如果启用，盈利退出会被标记为TAKE_PROFIT原因
# 可选值：true、false
# 实盘建议值：true
TAKE_PROFIT_REASON_ON_POSITIVE_PNL=true

# ========== AI配置 ==========
# AI功能是否启用
# 作用：是否启用在线学习AI模型
# 可选值：true、false
# 实盘建议值：true（推荐启用）
AI_ENABLED=true

# AI权重
# 作用：AI评分在最终决策中的权重（0-1）
# 可选值：0.2-0.5
# 实盘建议值：0.35
AI_WEIGHT=0.35

# AI学习率
# 作用：在线学习的学习率
# 可选值：0.01-0.1
# 实盘建议值：0.05
AI_LR=0.05

# AI L2正则化系数
# 作用：防止过拟合
# 可选值：0.000001-0.0001
# 实盘建议值：0.000001
AI_L2=0.000001

# AI最小样本数
# 作用：开始训练所需的最小样本数
# 可选值：30-100
# 实盘建议值：50
AI_MIN_SAMPLES=50

# AI模型键名
# 作用：Redis中存储AI模型的键名
# 实盘建议值：AI_MODEL_V1
AI_MODEL_KEY=AI_MODEL_V1

# AI模型实现
# 可选值：online_lr（在线逻辑回归）、sgd_compat（SGD兼容模式）
# 实盘建议值：online_lr
AI_MODEL_IMPL=online_lr

# ========== 运行模式 ==========
# 运行一次后退出（用于测试）
# 作用：如果启用，服务运行一个周期后退出
# 可选值：true、false
# 实盘建议值：false
RUN_ONCE=false

# ========== 运行时配置 ==========
# 运行时配置刷新间隔（秒）
# 作用：从数据库刷新配置的间隔
# 实盘建议值：30
RUNTIME_CONFIG_REFRESH_SECONDS=30

# 使用保护性止损订单
# 作用：是否使用交易所的止损订单功能
# 可选值：true、false
# 实盘建议值：true（推荐）
USE_PROTECTIVE_STOP_ORDER=true

# 止损订单轮询间隔（秒）
# 作用：检查止损订单状态的间隔
# 实盘建议值：10
STOP_ORDER_POLL_SECONDS=10

# ========== 数据同步优化 ==========
# 数据同步主循环间隔（秒）
# 作用：data-syncer主循环的睡眠时间
# 实盘建议值：30（进一步减少API请求）
DATA_SYNC_LOOP_INTERVAL_SECONDS=30

# 交易对间延迟（秒）
# 作用：处理每个交易对之间的延迟，减少API请求频率
# 实盘建议值：0.5
DATA_SYNC_SYMBOL_DELAY_SECONDS=0.5

# ========== 控制命令 ==========
# 控制命令轮询间隔（秒）
# 作用：轮询新控制命令的间隔
# 实盘建议值：2
CONTROL_POLL_SECONDS=2

# ========== 特性版本 ==========
# 特性缓存版本
# 作用：用于特性缓存的版本控制
# 实盘建议值：1
FEATURE_VERSION=1

# ========== Tick预算 ==========
# Tick预算时间（秒）
# 作用：每个tick应该在此时间内完成
# 实盘建议值：10
TICK_BUDGET_SECONDS=10

# ========== 持仓快照 ==========
# 持仓快照间隔（秒）
# 作用：定期写入持仓快照的间隔
POSITION_SNAPSHOT_INTERVAL_SECONDS=300

# ========== 分布式锁 ==========
# 交易锁TTL（秒）
# 作用：分布式交易锁的生存时间
# 实盘建议值：30
TRADE_LOCK_TTL_SECONDS=30

# ========== 止损订单处理 ==========
# 止损订单上锁最大重试次数
# 作用：设置止损订单时的最大重试次数
# 实盘建议值：3
STOP_ARM_MAX_RETRIES=3

# 止损订单退避基础时间（秒）
# 作用：重试时的基础退避时间
# 实盘建议值：0.5
STOP_ARM_BACKOFF_BASE_SECONDS=0.5

# 止损订单重新上锁最大尝试次数
# 作用：重新设置止损订单时的最大尝试次数
# 实盘建议值：2
STOP_REARM_MAX_ATTEMPTS=2

# 止损订单重新上锁冷却时间（秒）
# 作用：重新设置止损订单前的冷却时间
# 实盘建议值：30
STOP_REARM_COOLDOWN_SECONDS=60

# ========== 管理接口 ==========
# 管理令牌
# ⚠️ 重要：生产环境必须修改为强密码
# 实盘建议：使用随机生成的强密码（至少32字符）
ADMIN_TOKEN=change_me

# 管理令牌列表（逗号/空格分隔，用于密钥轮换）
# 作用：支持多个管理令牌，用于密钥轮换
# 格式：token1,token2,token3 或 token1 token2 token3
# 实盘建议：如果未设置，则使用ADMIN_TOKEN
ADMIN_TOKENS=

# 管理接口IP白名单（CIDR或单IP，逗号/空格分隔）
# 作用：限制管理接口的访问IP
# 格式：192.168.1.0/24,10.0.0.1 或 192.168.1.0/24 10.0.0.1
# 实盘建议：生产环境必须设置
# 说明：为空则不启用白名单（不推荐生产环境）
ADMIN_IP_ALLOWLIST=

# 高危操作二次确认
# 作用：如果启用，紧急退出等操作需要确认码
# 可选值：true、false
# 实盘建议值：true（推荐启用）
ADMIN_CONFIRM_REQUIRED=false

# 高危操作确认码
# 作用：执行高危操作时需要的确认码
# 实盘建议：设置一个强密码
ADMIN_CONFIRM_CODE=

# ========== Leader选举（高可用） ==========
# Leader选举是否启用
# 作用：多实例时仅leader执行同步/交易，followers仅心跳与指标
# 可选值：true、false
# 实盘建议值：true（多实例部署时）
LEADER_ELECTION_ENABLED=true

# Leader键前缀
# 作用：Redis中leader键的前缀
# 实盘建议值：leader
LEADER_KEY_PREFIX=leader

# Leader TTL（秒）
# 作用：Leader键的生存时间
# 实盘建议值：30
LEADER_TTL_SECONDS=30

# Leader续期间隔（秒）
# 作用：Leader续期的间隔
# 实盘建议值：10
LEADER_RENEW_INTERVAL_SECONDS=10

# Follower睡眠时间（秒）
# 作用：Follower在等待时的睡眠时间
# 实盘建议值：2
LEADER_FOLLOWER_SLEEP_SECONDS=2

# ========== Telegram通知 ==========
# Telegram Bot Token
# 作用：用于发送Telegram通知
# 获取方式：通过@BotFather创建bot并获取token
# 实盘建议：必须设置，用于接收交易和系统告警
TELEGRAM_BOT_TOKEN=

# Telegram Chat ID
# 作用：接收通知的Telegram聊天ID
# 获取方式：通过@userinfobot获取自己的chat_id
# 实盘建议：必须设置
TELEGRAM_CHAT_ID=

# Telegram JSON 摘要开关
# 作用：控制是否在 Telegram 告警中发送 JSON 摘要（详细信息）
# 可选值：
#   - true/1/yes/y（开启，发送 JSON 摘要）
#   - false/0/no/n（关闭，只发送文本摘要，默认）
# 实盘建议值：false（关闭 JSON 摘要，减少消息冗余）
TELEGRAM_SEND_JSON=false

# ========== 数据延迟告警 ==========
# 市场数据延迟告警阈值（秒）
# 作用：市场数据延迟超过此值时发送Telegram告警
# 可选值：
#   - 0 或负数（禁用告警，默认）
#   - 正数（秒），例如 120 表示延迟超过 2 分钟时告警

# 实盘建议值：0（禁用告警）
MARKET_DATA_LAG_ALERT_SECONDS=0
# 市场数据延迟告警冷却时间（秒）

# 默认值：1800（30分钟）
# 实盘建议值：1800（30分钟）
MARKET_DATA_LAG_ALERT_COOLDOWN_SECONDS=1800

# ========== 可观测性 ==========
# 指标端口
# 可选值：0（自动）、端口号（如8081）
# 实盘建议值：0（自动）或指定端口
METRICS_PORT=0

# 实例ID（可选）
# 作用：强制指定实例ID，否则使用hostname:pid
# 实盘建议：多实例部署时设置唯一ID
INSTANCE_ID=

# 心跳间隔（秒）
# 作用：服务心跳的间隔
# 实盘建议值：30
HEARTBEAT_INTERVAL_SECONDS=30

# ========== Binance配置 ==========
# Binance Base URL
# 作用：Binance API的基础URL
# 实盘建议值：https://fapi.binance.com（USDT合约）
BINANCE_BASE_URL=https://fapi.binance.com

# Binance API Key
# ⚠️ 重要：生产环境必须设置
# 获取方式：在Binance平台创建API密钥
# 实盘建议：使用只读+交易权限的API密钥
BINANCE_API_KEY=

# Binance API Secret
# ⚠️ 重要：生产环境必须设置，请妥善保管
# 获取方式：在Binance平台创建API密钥时获取
# 实盘建议：使用只读+交易权限的API密钥
BINANCE_API_SECRET=

# Binance接收窗口（毫秒）
# 作用：API请求的时间窗口
# 实盘建议值：5000
BINANCE_RECV_WINDOW=5000

# ========== Bybit配置 ==========
# Bybit Base URL
# 作用：Bybit API的基础URL
# 可选值：
#   - https://api.bybit.com（主站）
#   - https://api.bybit.com（测试网）
# 实盘建议值：https://api.bybit.com
BYBIT_BASE_URL=https://api.bybit.com

# Bybit API Key
# ⚠️ 重要：生产环境必须设置
# 获取方式：在Bybit平台创建API密钥
# 实盘建议：使用只读+交易权限的API密钥，确保没有前导/尾随空格
BYBIT_API_KEY=

# Bybit API Secret
# ⚠️ 重要：生产环境必须设置，请妥善保管
# 获取方式：在Bybit平台创建API密钥时获取
# 实盘建议：使用只读+交易权限的API密钥，确保没有前导/尾随空格
BYBIT_API_SECRET=

# Bybit接收窗口（毫秒）
# 作用：API请求的时间窗口
# 实盘建议值：5000
BYBIT_RECV_WINDOW=5000

# Bybit 公共 WebSocket URL
# 作用：公共 WebSocket 的连接地址，用于订阅市场数据（K线、订单簿等）
# 可选值：
#   - wss://stream.bybit.com/v5/public/linear（主站，线性合约）
#   - wss://stream-testnet.bybit.com/v5/public/linear（测试网）
# 实盘建议值：wss://stream.bybit.com/v5/public/linear（保持默认）
BYBIT_PUBLIC_WS_URL=wss://stream.bybit.com/v5/public/linear

# Bybit 私有 WebSocket URL
# 作用：私有 WebSocket 的连接地址，用于订阅订单状态、持仓、账户余额等
# 可选值：
#   - wss://stream.bybit.com/v5/private（主站）
#   - wss://stream-testnet.bybit.com/v5/private（测试网）
# 实盘建议值：wss://stream.bybit.com/v5/private（保持默认）
BYBIT_PRIVATE_WS_URL=wss://stream.bybit.com/v5/private

# Bybit WebSocket 启用开关
# 作用：控制是否启用 WebSocket 连接（启用后可大幅减少 REST API 请求）
# 可选值：
#   - true/1/yes/y（启用，推荐）
#   - false/0/no/n（禁用，使用 REST API）
# 实盘建议值：true（启用 WebSocket，减少 API 限制风险）
BYBIT_WS_ENABLED=true

# ========== 模拟交易配置 ==========
# 模拟交易起始资金（USDT）
# 作用：paper模式下的起始资金
# 实盘建议：仅用于测试，实盘不使用
PAPER_STARTING_USDT=1000

# 模拟交易手续费百分比
# 作用：paper模式下的手续费率
# 实盘建议：仅用于测试，实盘不使用
PAPER_FEE_PCT=0.0004

# ========== 数据存储格式说明 ==========
# 本系统使用PostgreSQL+Redis架构，数据以JSON格式存储：
#
# PostgreSQL（主数据库）：
#   - 所有业务数据存储在PostgreSQL的JSONB字段中
#   - 优势：灵活的数据结构、强大的JSON查询能力、ACID事务支持
#   - 表结构：使用JSONB字段存储订单、持仓、市场数据等
#   - 示例：order_events表使用payload_json JSONB字段存储完整订单信息
#
# Redis（缓存和实时数据）：
#   - 用于缓存、分布式锁、消息队列、实时数据流
#   - 优势：高性能、低延迟、支持发布订阅
#   - 用途：
#     * 缓存市场数据（减少数据库查询）
#     * 分布式锁（防止并发交易）
#     * 消息队列（服务间通信）
#     * 实时数据流（WebSocket数据）
#
# 数据迁移：
#   - 从MySQL/MariaDB迁移到PostgreSQL时，数据会自动转换为JSON格式
#   - 建议在生产环境迁移前先备份数据
#   - 迁移脚本会自动处理数据格式转换
